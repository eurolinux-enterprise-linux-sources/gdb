From e1b876b7b2aefe35bbf92b8ec65c95c5fa9fc13e Mon Sep 17 00:00:00 2001
From: Jan Kratochvil <jan.kratochvil@redhat.com>
Date: Fri, 18 May 2012 17:47:27 +0000
Subject: [PATCH] gdb/
 	Rename $ddir to $datadir.
 	* NEWS (--with-auto-load-dir): Rename $ddir to $datadir.
 	* auto-load.c (auto_load_safe_path_vec_update)
 	(auto_load_gdb_datadir_changed, auto_load_objfile_script): Likewise.
 	* configure: Regenerate.
 	* configure.ac (--with-auto-load-dir, --with-auto-load-safe-path):
 	Likewise.  Remove the 'use $ddir' help string.

gdb/doc/
	Rename $ddir to $datadir.
	* gdb.texinfo (Auto-loading, Auto-loading safe path)
	(objfile-gdb.py file): Rename $ddir to $datadir.
---
 gdb/ChangeLog       |   10 ++++++++++
 gdb/NEWS            |    4 ++--
 gdb/auto-load.c     |    8 ++++----
 gdb/configure       |   13 ++++++-------
 gdb/configure.ac    |   10 +++++-----
 gdb/doc/ChangeLog   |    6 ++++++
 gdb/doc/gdb.texinfo |   20 ++++++++++----------
 7 files changed, 43 insertions(+), 28 deletions(-)

Index: gdb-7.2/gdb/NEWS
===================================================================
--- gdb-7.2.orig/gdb/NEWS
+++ gdb-7.2/gdb/NEWS
@@ -197,8 +197,8 @@ show debug auto-load
 
 --with-auto-load-dir
   Configure default value for the 'set auto-load scripts-directory'
-  setting above.  It defaults to '$ddir/auto-load', $ddir representing
-  GDB's data directory (available via show data-directory).
+  setting above.  It defaults to '$datadir/auto-load', $datadir
+  representing GDB's data directory (available via show data-directory).
 
 --with-auto-load-safe-path
   Configure default value for the 'set auto-load safe-path' setting
Index: gdb-7.2/gdb/auto-load.c
===================================================================
--- gdb-7.2.orig/gdb/auto-load.c
+++ gdb-7.2/gdb/auto-load.c
@@ -174,13 +174,13 @@ auto_load_safe_path_vec_update (void)
       char *ddir_subst, *expanded, *real_path;
 
       ddir_subst = xstrdup (dir);
-      substitute_path_component (&ddir_subst, "$ddir", gdb_datadir);
+      substitute_path_component (&ddir_subst, "$datadir", gdb_datadir);
       expanded = tilde_expand (ddir_subst);
       xfree (ddir_subst);
       real_path = gdb_realpath (expanded);
 
       /* Ensure the current entry is at least a valid path (therefore
-	 $ddir-expanded and tilde-expanded).  */
+	 $datadir-expanded and tilde-expanded).  */
       VEC_replace (char_ptr, auto_load_safe_path_vec, ix, expanded);
 
       if (debug_auto_load)
@@ -212,7 +212,7 @@ auto_load_safe_path_vec_update (void)
     }
 }
 
-/* Variable gdb_datadir has been set.  Update content depending on $ddir.  */
+/* Variable gdb_datadir has been set.  Update content depending on $datadir.  */
 
 static void
 auto_load_gdb_datadir_changed (void)
@@ -699,7 +699,7 @@ auto_load_objfile_script (struct objfile
       for (ix = 0; VEC_iterate (char_ptr, vec, ix, dir); ++ix)
 	{
 	  debugfile = xstrdup (dir);
-	  substitute_path_component (&debugfile, "$ddir", gdb_datadir);
+	  substitute_path_component (&debugfile, "$datadir", gdb_datadir);
 	  debugfile = xrealloc (debugfile, (strlen (debugfile)
 					    + strlen (filename) + 1));
 
Index: gdb-7.2/gdb/configure
===================================================================
--- gdb-7.2.orig/gdb/configure
+++ gdb-7.2/gdb/configure
@@ -1659,20 +1659,19 @@ Optional Packages:
   --with-relocated-sources=PATH
                           automatically relocate this path for source files
   --with-auto-load-dir=PATH
-                          directories from which to load auto-loaded scripts,
-                          use '$ddir' for -data-directory [$ddir/auto-load]
+                          directories from which to load auto-loaded scripts
+                          [$datadir/auto-load]
+  --with-auto-load-safe-path=PATH
+                          directories safe to hold auto-loaded files
+                          [--with-auto-load-dir]
+  --without-auto-load-safe-path
+                          do not restrict auto-loaded files locations
   --with-gdb-datadir      look for global separate data files in this path
                           [DATADIR/gdb]
   --with-pythondir        install Python data files in this path
                           [DATADIR/gdb/python]
   --with-rpm              query rpm database for missing debuginfos (yes/no,
                           def. auto=librpm.so)
-  --with-auto-load-safe-path=PATH
-                          directories safe to hold auto-loaded files, use
-                          $ddir for --with-gdb-datadir path
-                          [--with-auto-load-dir]
-  --without-auto-load-safe-path
-                          do not restrict auto-loaded files locations
   --with-libunwind        use libunwind frame unwinding support
   --with-curses           use the curses library instead of the termcap
                           library
@@ -8461,10 +8460,10 @@ $as_echo_n "checking for default auto-lo
 if test "${with_auto_load_dir+set}" = set; then :
   withval=$with_auto_load_dir;
 else
-  with_auto_load_dir='$ddir/auto-load'
+  with_auto_load_dir='$datadir/auto-load'
 fi
 
-escape_dir=`echo $with_auto_load_dir | sed 's/[$]ddir\>/\\\\\\\\\\\\&/g'`
+escape_dir=`echo $with_auto_load_dir | sed 's/[$]datadir\>/\\\\\\\\\\\\&/g'`
 
   test "x$prefix" = xNONE && prefix="$ac_default_prefix"
   test "x$exec_prefix" = xNONE && exec_prefix='${prefix}'
@@ -8491,7 +8490,7 @@ else
   with_auto_load_safe_path="$with_auto_load_dir"
 fi
 
-escape_dir=`echo $with_auto_load_safe_path | sed 's/[$]ddir\>/\\\\\\\\\\\\&/g'`
+escape_dir=`echo $with_auto_load_safe_path | sed 's/[$]datadir\>/\\\\\\\\\\\\&/g'`
 
   test "x$prefix" = xNONE && prefix="$ac_default_prefix"
   test "x$exec_prefix" = xNONE && exec_prefix='${prefix}'
Index: gdb-7.2/gdb/configure.ac
===================================================================
--- gdb-7.2.orig/gdb/configure.ac
+++ gdb-7.2/gdb/configure.ac
@@ -348,9 +348,9 @@ fi
 AC_MSG_CHECKING([for default auto-load directory])
 AC_ARG_WITH(auto-load-dir,
 AS_HELP_STRING([--with-auto-load-dir=PATH],
-  [directories from which to load auto-loaded scripts, use '$ddir' for -data-directory @<:@$ddir/auto-load@:>@]),,
-  [with_auto_load_dir='$ddir/auto-load'])
-escape_dir=`echo $with_auto_load_dir | sed 's/[[$]]ddir\>/\\\\\\\\\\\\&/g'`
+  [directories from which to load auto-loaded scripts @<:@$datadir/auto-load@:>@]),,
+  [with_auto_load_dir='$datadir/auto-load'])
+escape_dir=`echo $with_auto_load_dir | sed 's/[[$]]datadir\>/\\\\\\\\\\\\&/g'`
 AC_DEFINE_DIR(AUTO_LOAD_DIR, escape_dir,
 	      [Directories from which to load auto-loaded scripts.])
 AC_MSG_RESULT([$with_auto_load_dir])
@@ -358,14 +358,14 @@ AC_MSG_RESULT([$with_auto_load_dir])
 AC_MSG_CHECKING([for default auto-load safe-path])
 AC_ARG_WITH(auto-load-safe-path,
 AS_HELP_STRING([--with-auto-load-safe-path=PATH],
-  [directories safe to hold auto-loaded files, use $ddir for --with-gdb-datadir path @<:@--with-auto-load-dir@:>@])
+  [directories safe to hold auto-loaded files @<:@--with-auto-load-dir@:>@])
 AS_HELP_STRING([--without-auto-load-safe-path],
                [do not restrict auto-loaded files locations]),
     [if test "$with_auto_load_safe_path" = "no"; then
      with_auto_load_safe_path="/"
      fi],
 [with_auto_load_safe_path="$with_auto_load_dir"])
-escape_dir=`echo $with_auto_load_safe_path | sed 's/[[$]]ddir\>/\\\\\\\\\\\\&/g'`
+escape_dir=`echo $with_auto_load_safe_path | sed 's/[[$]]datadir\>/\\\\\\\\\\\\&/g'`
 AC_DEFINE_DIR(AUTO_LOAD_SAFE_PATH, escape_dir,
 	      [Directories safe to hold auto-loaded files.])
 AC_MSG_RESULT([$with_auto_load_safe_path])
Index: gdb-7.2/gdb/doc/gdb.texinfo
===================================================================
--- gdb-7.2.orig/gdb/doc/gdb.texinfo
+++ gdb-7.2/gdb/doc/gdb.texinfo
@@ -19773,9 +19773,9 @@ local-gdbinit:  Auto-loading of .gdbinit
                 is on.
 python-scripts:  Auto-loading of Python scripts is on.
 safe-path:  List of directories from which it is safe to auto-load files
-            is $ddir/auto-load.
+            is $datadir/auto-load.
 scripts-directory:  List of directories from which to load auto-loaded scripts
-                    is $ddir/auto-load.
+                    is $datadir/auto-load.
 @end smallexample
 
 @anchor{info auto-load}
@@ -19991,9 +19991,9 @@ get loaded:
 $ ./gdb -q ./gdb
 Reading symbols from /home/user/gdb/gdb...done.
 warning: File "/home/user/gdb/gdb-gdb.gdb" auto-loading has been
-         declined by your `auto-load safe-path' set to "$ddir/auto-load".
+         declined by your `auto-load safe-path' set to "$datadir/auto-load".
 warning: File "/home/user/gdb/gdb-gdb.py" auto-loading has been
-         declined by your `auto-load safe-path' set to "$ddir/auto-load".
+         declined by your `auto-load safe-path' set to "$datadir/auto-load".
 @end smallexample
 
 The list of trusted directories is controlled by the following commands:
@@ -20026,7 +20026,7 @@ host platform path separator in use.
 @end table
 
 This variable defaults to what @code{--with-auto-load-dir} has been configured
-to (@pxref{with-auto-load-dir}).  @file{$ddir} substituation applies the same
+to (@pxref{with-auto-load-dir}).  @file{$datadir} substituation applies the same
 as for @xref{set auto-load scripts-directory}.
 The default @code{set
 auto-load safe-path} value can be also overriden by @value{GDBN} configuration
@@ -23316,14 +23316,14 @@ Each entry here needs to be covered also
 @code{set auto-load safe-path} (@pxref{set auto-load safe-path}).
 
 @anchor{with-auto-load-dir}
-This variable defaults to @file{$ddir/auto-load}.  The default @code{set
+This variable defaults to @file{$datadir/auto-load}.  The default @code{set
 auto-load safe-path} value can be also overriden by @value{GDBN} configuration
 option @option{--with-auto-load-dir}.
 
-Any used string @file{$ddir} will get replaced by @var{data-directory} which is
-determined at @value{GDBN} startup (@pxref{Data Files}).  @file{$ddir} must be
-be placed as a directory component --- either alone or delimited by @file{/} or
-@file{\} directory separators, depending on the host platform.
+Any used string @file{$datadir} will get replaced by @var{data-directory} which
+is determined at @value{GDBN} startup (@pxref{Data Files}).  @file{$datadir}
+must be placed as a directory component --- either alone or delimited by
+@file{/} or @file{\} directory separators, depending on the host platform.
 
 The list of directories uses path separator (@samp{:} on GNU and Unix
 systems, @samp{;} on MS-Windows and MS-DOS) to separate directories, similarly
